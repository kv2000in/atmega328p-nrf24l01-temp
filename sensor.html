<!DOCTYPE html>
<html>

	<head>
		
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
			<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 
			<meta http-equiv="Content-Language" content="hi" />
			<title>Smart Sensors</title>
			<style>
				* {
					box-sizing: border-box;
				}
			
			html {
				font-family: "Lucida Sans", sans-serif;
				font-size: 100%;
			}
			
			[class*="col-"] {
				float: left;
				padding-left: 15px;
				padding-right: 15px;
			}
			
			/* For mobile phones: */
			[class*="col-"] {
				width: 100%;
			}
			.topright{
				height:160px;
			}
			
			@media only screen and (min-width: 768px) {
				/* For desktop: */ .col-1 {
					width: 8.33%;
				}
				
				.col-2 {
					width: 16.66%;
				}
				
				.col-3 {
					width: 25%;
				}
				
				.col-4 {
					width: 33.33%;
				}
				
				.col-5 {
					width: 41.66%;
				}
				
				.col-6 {
					width: 50%;
				}
				
				.col-7 {
					width: 58.33%;
				}
				
				.col-8 {
					width: 66.66%;
				}
				
				.col-9 {
					width: 75%;
				}
				
				.col-10 {
					width: 83.33%;
				}
				
				.col-11 {
					width: 91.66%;
				}
				
				.col-12 {
					width: 100%;
				}
				
				.topright{
					
					margin-top:160px;
					height:290px;
				}
			}
			
			
			/* For mobile*/
			
			ul {
				list-style-type: none;
				margin: 0;
				padding: 0;
			}
			
			.digitaldisplay {
				color: #2509e8;
				text-align: center;
				width: 40px;
				float: left;
				font-weight: bold;
				padding-top: 5px;
				padding-bottom: 5px;
				font-size: x-large;
				position: absolute;
				z-index: -1;
				margin-left: 15px;
			}
			
			.Psensordisplay{
				color:blue;
			}
			.Tsensordisplay{
				color:blue;
			}
			.topleft{
				
				margin-top:160px;
			}
			
			.statuslight {
				background-color: rgba(220, 187, 187, 0.41);
				width: 30px;
				height: 30px;
				border-radius: 25%;
				border-width: 0px;
				padding-top: 7.5px;
				padding-bottom: 7.5px;
				position: absolute;
				z-index: -1;
				margin-left: 15px;
			}  
			.statuslight:focus{
				border-collapse: collapse;
				
			}
			.statuslight:active{
				box-shadow: 0px 0px 60px 7px orange;
				background-color: crimson;  
			}
			
			.activebutton{
				box-shadow: 0px 0px 20px 12px #ffb700;
				background-color: #ed1414;
				width: 30px;
				height: 30px;
				border-radius: 25%;
				border-width: 0px;
				position: absolute;
				z-index: -1;
				margin-left: 15px;
				
			}
			.labeltxts {
				padding-left: 90px;
				padding-top: 7.5px;
				padding-bottom: 7.5px;
				position: absolute;
				z-index: -1;
			}
			
			/* The animation code */
			@keyframes example {
				0%   {right:0px; }
				100% {right:180px;}
			}
			
			.softmode{
				border-color:aqua;
				
				
			}
			.softmodeactive{
				border-style:solid;
				border-color: red;
			}
			
			.switch {
				position: relative;
				display: inline-block;
				width: 60px;
				height: 40px;
			}
			.switch input {display:none;}
			
			.slider {
				position: absolute;
				cursor: pointer;
				top: 0;
				left: 0;
				right: 0;
				bottom: 0;
				background-color: white;
				-webkit-transition: .4s;
				transition: .4s;
				border-bottom-left-radius: 50%;
				border-top-left-radius: 50%
			}
			
			.slider:before {
				position: absolute;
				content: "";
				height: 28px;
				width: 16px;
				left: 14px;
				bottom: 5px;
				background-color: black;
				-webkit-transition: .4s;
				transition: .4s;
			}
			
			input:checked + .slider {
				background-color: #2196F3;
			}
			
			input:focus + .slider {
				box-shadow: 0 0 1px #2196F3;
			}
			
			input:checked + .slider:before {
				-webkit-transform: translateX(16px);
				-ms-transform: translateX(16px);
				transform: translateX(16px);
			}
			input:checked + .slider {
				/*input+slider - only works for slider class immediatley after the input*/
				
				border-bottom-left-radius: 0%;
				border-top-left-radius: 0%;
				border-bottom-right-radius: 50%;
				border-top-right-radius: 50%   
			}  
			
			
			
			
			td.label{
				flex-wrap: nowrap; 
			}
			.topbar{
				position: fixed;
				top: 0;
				width: 80%;
				left: 10%;
				margin: auto;
				text-align: center;
				border-radius: 5%;
				background-color: #10ede2;
				z-index: 10;
			}          
			
			
			
			.control li{
				
				height: 80px;
				width:100%;
				display: inline-flex;
			}
			.tankanim{
				
				
				animation-name: example;
				position: relative;
				animation-duration: 10s;
				animation-iteration-count: 2;
			}
			table,  td {
			}
			.top table{
				width:100%
			}
			.status td {
				padding: 8px;
				width: 250px;
				height:76px;
				margin-bottom: 7px;
			}
			.activesensor {
				text-align: center;
				padding: 8px;
				border-radius: 25px;
				margin-bottom: 7px;
				background-color: #33cc46;
				color: #ffffff;
				box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
			}
			
			.downsensor{
				background-color: #ccc;
				text-align: center;
				padding: 8px;
				border-radius: 25px;
				margin-bottom: 7px;
				color: #ffffff;
				box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
				
			}
			
			.activesensor li {
				padding: 8px;
				margin-bottom: 7px;
				border-radius: 25px;
				background-color: #e53333;
				color: #ffffff;
				box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
			}
			
			.downsensor li {
				padding: 8px;
				margin-bottom: 7px;
				border-radius: 25px;
				background-color: black;
				color: #ffffff;
				box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
			}
			
			.hide{
				visibility: hidden
			}
			.pushbtn{
				width:120px;
				height:60px;
				/*border-radius: 40%;*/
				font-size:200%; 
				/*background-color: red;*/
				
				
			}
			
			
			
			.topleft li{
				height:40px;
			}      
			.buttonpressedeffect {
				display: inline-block;
				padding: 15px 25px;
				font-size: 24px;
				cursor: pointer;
				text-align: center;
				text-decoration: none;
				outline: none;
				color: #fff;
				background-color: #4CAF50;
				border: none;
				border-radius: 15px;
				box-shadow: 0 9px #999;
			}
			
			/*.buttonpressedeffect:hover {background-color: #3e8e41}*/
			
			.buttonpressedeffect:active {
				background-color: #3e8e41;
				box-shadow: 0 5px #666;
				transform: translateX(4px);
			}
			.tankslider{
				
				background-color: #2196F3;
				z-index:-1
			}
			
			.tankbtn{
				
				background-color:#2196F3 ;
				width: 120px;
				height: 40px;
				border-radius: 15px;
				border-style: hidden;
				font-size: 20px;
				/*background-color:#10ede2; */
			}
			
			.tankbtn:disabled{
				
				background-color: #ccc;
				box-shadow: none;
				color: #999; 
			}
			
			/*   .softmode{
			 
			 border-style: solid;
			 border-color: black;
			 -webkit-transition: .4s;
			 transition: .4s;
			 }*/
			
			.tanklevelbg{
				
				background-color: aliceblue;
				border-radius: 15px;
				padding: 0px;
			}
			.tanklevelfg{
				background-color: blue;
				border-right-style: solid;
				border-right-color: black;
				
				
			}
			
			
			/* Tooltip container */
			#settings {
				position: relative;
				display: inline-block;
				/*border-bottom: 1px dotted black; *//* If you want dots under the hoverable text */
			}
			
			/* Tooltip text */
			#settings+.settingsbox {
				visibility: hidden;
				top:0%;
				left:0%;
				background-color: #4c45ad;
				color: #fff;
				text-align: center;
				padding: 5px 0;
				border-radius: 6px;
				
				/* Position the tooltip text - see examples below! */
				position: absolute;
				z-index: 1;
			}
			.settingsbox input {
				font-style: normal;
				font-weight: bold;
			}
			
			#cal {
				position: relative;
				display: inline-block;
				/*border-bottom: 1px dotted black; *//* If you want dots under the hoverable text */
			}
			
			/* Tooltip text */
			#cal+.calbox {
				visibility: hidden;
				top:0%;
				left:0%;
				background-color: #4c45ad;
				color: #fff;
				text-align: center;
				padding: 5px 0;
				border-radius: 6px;
				
				/* Position the tooltip text - see examples below! */
				position: absolute;
				z-index: 1;
			}
			.calbox input {
				font-style: normal;
				font-weight: bold;
			}
			/* Show the tooltip text when you mouse over the tooltip container 
			 #settings:hover+.settingsbox {
			 visibility: visible;
			 }
			 */     
			
			
			.tooltip {
				position: relative;
				/*display: inline-block;*/
				border-bottom: 1px dotted black;
			}
			
			.tooltip .tooltiptext {
				visibility: hidden;
				width: 120px;
				background-color: #555;
				color: #fff;
				text-align: center;
				border-radius: 6px;
				padding: 5px 0;
				position: absolute;
				z-index: 1;
				bottom: 125%;
				left: 50%;
				margin-left: -60px;
				opacity: 0;
				transition: opacity 1s;
			}
			
			.tooltip .tooltiptext::after {
				content: "";
				position: absolute;
				top: 100%;
				left: 50%;
				margin-left: -5px;
				border-width: 5px;
				border-style: solid;
				border-color: #555 transparent transparent transparent;
			}
			
			.tooltip:hover .tooltiptext {
				visibility: visible;
				opacity: 1;
			}
			
				</style>
			<script src="plotly.js" type="text/javascript" charset="utf-8"></script>
			<script language="javascript" type="text/javascript">
				
				/*    WEBSOCKET HANDLING JAVASCRIPT*/
				
				/*var allswitches=document.getElementsByTagName("input");*/ /* get all elements by tag name input*/
				
				
				
				function init()
				{
					
					
					
					
					
					/*
					 document.myform.url.value = "ws://192.168.1.118:8000/"
					 document.myform.inputtext.value = "Hello World!"
					 document.myform.disconnectButton.disabled = true;
					 */
				}
			var websocket;
			function doConnect()
			{
				
				
				var hostipaddr=location.host.split(":")[0]; /*location.host gives 192.168.1.110:62246*/
				/*websocket = new WebSocket(document.myform.url.value);*/
				/* websocket = new WebSocket("ws://192.168.1.110:8000/");*/
				websocket = new WebSocket("ws://"+hostipaddr+":8000/");
				websocket.onopen = function(evt) { onOpen(evt) };
				websocket.onclose = function(evt) { onClose(evt) };
				websocket.onmessage = function(evt) { onMessage(evt) };
				websocket.onerror = function(evt) { onError(evt) };
				
			}
			
			function onOpen(evt)
			{
				console.log("connected\n");
				
			}
			
			function onClose(evt)
			{
				console.log("disconnected\n");
				
			}
			function onMessage(evt)
			{
				/* data returned from Server is in the form of "SensorData=1483806901.06, t15.78"
				
				 */
				
				
				var arrdata=evt.data.split("=");
				switch(arrdata[0]){
					case 'SensorData':
					handlesensordata(arrdata[1]);
					break;
					case 'StoredData':
					queryServer3(evt.data);
					break;
					case 'STATUS':
					queryServer4(arrdata[1]);
					break;
					case 'POWERDATA':
					queryServer4(arrdata[1]);
					break;
					case 'SETTINGS':
					queryServer5(arrdata[1]);
					break;
					case 'MANUAL':
					queryServer6(arrdata[1]);
					break;
					/*    This one is for plotting the current and voltage ADCs*/
					case 'RawADC':
					queryServer7(arrdata[1]);
					break;
					case 'CAL':
					queryServer8(arrdata[1]);
					break;
					/*           This one is for raw RMS ADC data and raw sensor data*/
					case 'raw':
					queryServer9(arrdata[1]);
					break;
					default:
					console.log(arrdata[0].slice(-1));
					break;
				}
			}
			/*writeToScreen("response: " + evt.data + '\n');*/
			
			
			function onError(evt)
			{
				/*writeToScreen('error: ' + evt.data + '\n');*/
				console.log('error: ' + evt.data + '\n');
				websocket.close();
				
				/*document.myform.connectButton.disabled = false;
				 document.myform.disconnectButton.disabled = true;*/
				
			}
			
			function doSend(message)
			{
				console.log("sent: " + message + '\n');
				/* writeToScreen("sent: " + message + '\n'); */
				websocket.send(message);
			}
			
			/*function writeToScreen(message)
			 {
			 document.myform.outputtext.value += message
			 document.myform.outputtext.scrollTop = document.myform.outputtext.scrollHeight;
			 }*/
			
			window.addEventListener("load",doConnect, false);
			
			function ws_close(){
				websocket.close();
			}
			
			

			
				</script>
	</head>
	<!--<body onload="queryServer3()"> -->
	<body style="margin:0;">

			<div class = "sensors col-6">
                <table>
                    <tr>
                        <td class="sensorlabel">
                            <label id ="tlabel" class="temp">Outside Temp</label></td>
                        <td class="sensorvalue">
                            <input type="text" id="t">
                        </td>
                        <td class="sensortime">
                            <input type="datetime" id="ttime">
                        </td>
                    
                    </tr>
                    <tr>
                        <td class="sensorlabel">
                            <label id ="Vlabel" class="temp">Outside Battery</label></td>
                        <td class="sensorvalue">
                            <input type="text" id="V">
                        </td>

                    
                    </tr>
                    <tr>
                        <td class="sensorlabel">
                            <label id ="Alabel" class="temp">Inside Temp1</label></td>
                        <td class="sensorvalue">
                            <input type="text" id="A">
                        </td>
                        <td class="sensortime">
                            <input type="datetime" id="Atime">
                        </td>
                    
                    </tr>
                    <tr>
                        <td class="sensorlabel">
                            <label id ="alabel" class="temp">Inside Temp2</label></td>
                        <td class="sensorvalue">
                            <input type="text" id="a">
                        </td>
                        <td class="sensortime">
                            <input type="datetime" id="atime">
                        </td>
                    
                    </tr>
                    <tr>
                        <td class="sensorlabel">
                            <label id ="Blabel" class="temp">Moisture 1</label></td>
                        <td class="sensorvalue">
                            <input type="text" id="B">
                        </td>
                        <td class="sensortime">
                            <input type="datetime" id="Btime">
                        </td>
                    
                    </tr>
                    <tr>
                        <td class="sensorlabel">
                            <label id ="Clabel" class="temp">Moisture 2</label></td>
                        <td class="sensorvalue">
                            <input type="text" id="C">
                        </td>
                        <td class="sensortime">
                            <input type="datetime" id="Ctime">
                        </td>
                    
                    </tr>
                    <tr>
                        <td class="sensorlabel">
                            <label id ="Dlabel" class="temp">Moisture 3</label></td>
                        <td class="sensorvalue">
                            <input type="text" id="D">
                        </td>
                        <td class="sensortime">
                            <input type="datetime" id="Dtime">
                        </td>
                    
                    </tr>
                    <tr>
                        <td class="sensorlabel">
                            <label id ="Elabel" class="temp">Moisture 4</label></td>
                        <td class="sensorvalue">
                            <input type="text" id="E">
                        </td>
                        <td class="sensortime">
                            <input type="datetime" id="Etime">
                        </td>
                    
                    </tr>
                    <tr>
                        <td class="sensorlabel">
                            <label id ="2label" class="temp">Distance 2</label></td>
                        <td class="sensorvalue">
                            <input type="text" id="2">
                        </td>
                        <td class="sensortime">
                            <input type="datetime" id="2time">
                        </td>
                    
                    </tr>
                    <tr>
                        <td class="sensorlabel">
                            <label id ="vlabel" class="temp">Distance Battery</label></td>
                        <td class="sensorvalue">
                            <input type="text" id="v">
                        </td>

                    
                    </tr>
                </table>
        </div>
        <datalist id="listofsensors">
        
            <option value="Outside Temp">
            <option value="Outside Battery">
            <option value="Inside Temp1">
            <option value="Inside Temp2">
            <option value="Moisture 1">
            <option value="Moisture 2">
            <option value="Moisture 3">
            <option value="Moisture 4">
            <option value="Distance 2">
            <option value="Distance 2 battery">
        </datalist>
        <div class = "col-12 selectsensorsforplot">
        <input type="text" list="listofsensors"> <input type="button" id="addtosensorslisttoplot" value="Add">
        <p class="genericparagraph" id="listofsensorsaddedforplotting">Empty</p>
        <label class = "genericlabels">From</label><input type="datetime-local" id="plotfromthistime">
        <label class = "genericlabels">To</label><input type="datetime-local" id="plottothistime">
        <br>
        <input type="button" id="buildplotrequestandexecute" value="Plot">
        </div> 
			
			<div class="col-12">
				<!--        plot # 1 space-->
				<div id="9ab6bde0-5a69-4f53-a80c-d2e19447d850" class="plotly-graph-div"></div>
			</div>
			<div class="col-12">
				<!--          plot #2 space-->
				<div id="9ab6bde0-5a69-4f53-a80c-d2e19447d851" class="plotly-graph-div"></div>
			</div>
			<div class="col-12">
				<!--        plot #3 space-->
				
				<div id="9ab6bde0-5a69-4f53-a80c-d2e19447d852" class="plotly-graph-div"></div>
			</div>
        	</body>
			<script type="text/javascript">
                
                function handlesensordata(data) 
	
			/* This function sets the displays with updated values*/
{
  
         
           var mystring=data; 
           /*mystring  format will be 02/20/2021|21-04-33:t:-1.09:4465 or 02/20/2021|21-04-33:B: 99.9     */   
        
          var arr2 = mystring.split(":"); /* arr2[0]=02/20/2021|21-04-33 and arr2[1]=t arr2[2]=-1.09 arr2[3]=-4465*/
          switch(arr2[1].charAt(0)){

                  case 't':
                    document.getElementById("ttime").value = arr2[0];  
                    document.getElementById("t").value = arr2[2];
                      document.getElementById("V").value= arr2[3];
                    
                      break;
                case '2':
                    document.getElementById("2time").value = arr2[0];  
                    document.getElementById("2").value = arr2[2];
                      document.getElementById("v").value= arr2[3];
                    
                      break;
                  default:
                  
                   document.getElementById(arr2[1]+"time").value = arr2[0];
                  document.getElementById(arr2[1]).value = arr2[2];
                  
            }

          
          
          
          
 
};
				</script>
			<script type="text/javascript">
				
				/*window.removeEventListener("resize");*/
				window.addEventListener("resize", function(){Plotly.Plots.resize(document.getElementById("9ab6bde0-5a69-4f53-a80c-d2e19447d850"));});
				window.removeEventListener("resize", function(){Plotly.Plots.resize(document.getElementById("9ab6bde0-5a69-4f53-a80c-d2e19447d850"));});
				
				window.addEventListener("resize", function(){Plotly.Plots.resize(document.getElementById("9ab6bde0-5a69-4f53-a80c-d2e19447d851"));});
				window.removeEventListener("resize", function(){Plotly.Plots.resize(document.getElementById("9ab6bde0-5a69-4f53-a80c-d2e19447d851"));});
				
				window.addEventListener("resize", function(){Plotly.Plots.resize(document.getElementById("9ab6bde0-5a69-4f53-a80c-d2e19447d852"));});
				window.removeEventListener("resize", function(){Plotly.Plots.resize(document.getElementById("9ab6bde0-5a69-4f53-a80c-d2e19447d852"));});
				
				</script>
		

</html>
